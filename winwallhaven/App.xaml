<?xml version="1.0" encoding="utf-8"?>

<Application
    x:Class="winwallhaven.App"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:winwallhaven.Responsive"
    xmlns:conv="using:winwallhaven.Converters"
    xmlns:controls="using:winwallhaven.Controls">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <XamlControlsResources xmlns="using:Microsoft.UI.Xaml.Controls" />
                <!-- Other merged dictionaries here -->
            </ResourceDictionary.MergedDictionaries>

            <!-- Converters -->
            <conv:PurityToBrushConverter x:Key="PurityToBrushConverter" />
            <conv:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
            <conv:FileSizeToStringConverter x:Key="FileSizeToStringConverter" />
            <conv:HexColorToBrushConverter x:Key="HexColorToBrushConverter" />
            <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />

            <!-- Shared Resources for Responsive Wallpaper Grid -->

            <!-- Wallpaper Item Data Template -->
            <DataTemplate x:Key="WallpaperItemTemplate">
                <Grid>
                    <Border CornerRadius="8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                        <Grid>
                            <controls:AsyncImage Source="{Binding Thumb}" />
                            <!-- Overlays (absolute alignment to avoid stretching) -->
                            <Grid>
                                <ItemsControl Margin="6" ItemsSource="{Binding Colors}" HorizontalAlignment="Left"
                                              VerticalAlignment="Top">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="2" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Width="14" Height="14" CornerRadius="2"
                                                    Background="{Binding Converter={StaticResource HexColorToBrushConverter}}"
                                                    BorderBrush="#66000000" BorderThickness="1" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <StackPanel Margin="6" Spacing="2" HorizontalAlignment="Right" VerticalAlignment="Top">
                                    <Border Padding="6,2" CornerRadius="4"
                                            Background="{Binding Purity, Converter={StaticResource PurityToBrushConverter}}">
                                        <TextBlock Text="{Binding Purity}" FontSize="11" FontWeight="SemiBold"
                                                   Foreground="White" />
                                    </Border>
                                    <Border Padding="6,2" CornerRadius="4" Background="#66000000">
                                        <TextBlock Text="{Binding Category}" FontSize="11" Foreground="White" />
                                    </Border>
                                </StackPanel>
                                <Border Margin="6" Padding="6,2" CornerRadius="4" Background="#66000000"
                                        HorizontalAlignment="Left" VerticalAlignment="Bottom">
                                    <TextBlock Text="{Binding Resolution}" FontSize="11" Foreground="White" />
                                </Border>
                                <StackPanel Margin="6" HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                            Spacing="2">
                                    <Border Padding="6,2" CornerRadius="4" Background="#66000000">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon Glyph="&#xE890;" FontSize="12" Foreground="White" />
                                            <TextBlock Text="{Binding Views}" FontSize="11" Foreground="White" />
                                        </StackPanel>
                                    </Border>
                                    <Border Padding="6,2" CornerRadius="4" Background="#66000000">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon Glyph="&#xE734;" FontSize="12" Foreground="White" />
                                            <TextBlock Text="{Binding Favorites}" FontSize="11" Foreground="White" />
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>
                    <!-- Tooltip with extra details -->
                    <ToolTipService.ToolTip>
                        <ToolTip>
                            <StackPanel Spacing="4">
                                <TextBlock>
                                    <Run Text="File Type: " /><Run Text="{Binding FileType}" />
                                </TextBlock>
                                <TextBlock>
                                    <Run Text="Ratio: " /><Run Text="{Binding Ratio}" />
                                </TextBlock>
                                <TextBlock>
                                    <Run Text="Size: " />
                                    <Run
                                        Text="{Binding FileSize, Converter={StaticResource FileSizeToStringConverter}}" />
                                </TextBlock>
                                <TextBlock>
                                    <Run Text="Created: " /><Run Text="{Binding CreatedAt}" />
                                </TextBlock>
                            </StackPanel>
                        </ToolTip>
                    </ToolTipService.ToolTip>
                </Grid>
            </DataTemplate>

            <!-- Responsive GridView Style -->
            <Style x:Key="ResponsiveWallpaperGridView" TargetType="GridView">
                <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled" />
                <Setter Property="ScrollViewer.HorizontalScrollMode" Value="Disabled" />
                <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />
                <Setter Property="ScrollViewer.VerticalScrollMode" Value="Enabled" />
                <Setter Property="ScrollViewer.IsHorizontalRailEnabled" Value="False" />
                <Setter Property="ScrollViewer.IsVerticalRailEnabled" Value="True" />
                <Setter Property="ScrollViewer.ZoomMode" Value="Disabled" />
                <Setter Property="SelectionMode" Value="Single" />
                <Setter Property="ItemTemplate" Value="{StaticResource WallpaperItemTemplate}" />
                <Setter Property="Padding" Value="20" />
                <Setter Property="local:GridViewColumnSizer.EnableResponsiveColumns" Value="True" />
                <Setter Property="local:GridViewColumnSizer.PageSize" Value="96" />
                <Setter Property="local:GridViewColumnSizer.MinItemWidth" Value="180" />
                <Setter Property="local:GridViewColumnSizer.MaxItemWidth" Value="300" />
                <Setter Property="ItemsPanel">
                    <Setter.Value>
                        <ItemsPanelTemplate>
                            <ItemsWrapGrid Orientation="Horizontal"
                                           HorizontalAlignment="Center" />
                        </ItemsPanelTemplate>
                    </Setter.Value>
                </Setter>
                <Setter Property="ItemContainerStyle">
                    <Setter.Value>
                        <Style TargetType="GridViewItem">
                            <Setter Property="Margin" Value="10" />
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            <Setter Property="VerticalContentAlignment" Value="Stretch" />
                            <Setter Property="CornerRadius" Value="8" />
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="BorderThickness" Value="0" />
                        </Style>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Responsive GridView Style with Context Menu (shared, no history delete) -->
            <Style x:Key="ResponsiveWallpaperGridViewWithMenu" TargetType="GridView"
                   BasedOn="{StaticResource ResponsiveWallpaperGridView}">
                <Setter Property="ItemTemplate">
                    <Setter.Value>
                        <DataTemplate>
                            <Grid>
                                <Border CornerRadius="8"
                                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                                    <Grid>
                                        <controls:AsyncImage Source="{Binding Thumb}" Tag="{Binding}">
                                            <controls:AsyncImage.ContextFlyout>
                                                <MenuFlyout>
                                                    <MenuFlyoutItem Text="Open in Browser" Icon="Globe"
                                                                    Command="{Binding DataContext.OpenInBrowserCommand, ElementName=RootPage}"
                                                                    CommandParameter="{Binding}" />
                                                    <MenuFlyoutItem Text="Download" Icon="Download"
                                                                    Command="{Binding DataContext.DownloadCommand, ElementName=RootPage}"
                                                                    CommandParameter="{Binding}" />
                                                    <MenuFlyoutItem Text="Set as Wallpaper" Icon="Pictures"
                                                                    Command="{Binding DataContext.SetAsWallpaperCommand, ElementName=RootPage}"
                                                                    CommandParameter="{Binding}" />
                                                    <MenuFlyoutItem Text="Set as Lock Screen" Icon="ProtectedDocument"
                                                                    Command="{Binding DataContext.SetAsLockScreenCommand, ElementName=RootPage}"
                                                                    CommandParameter="{Binding}" />
                                                    <MenuFlyoutItem Text="Set Both"
                                                                    Icon="Sync"
                                                                    Command="{Binding DataContext.SetAsBothCommand, ElementName=RootPage}"
                                                                    CommandParameter="{Binding}" />
                                                </MenuFlyout>
                                            </controls:AsyncImage.ContextFlyout>
                                        </controls:AsyncImage>
                                        <!-- Overlays (absolute alignment) -->
                                        <Grid>
                                            <ItemsControl Margin="6" ItemsSource="{Binding Colors}"
                                                          HorizontalAlignment="Left" VerticalAlignment="Top">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel Orientation="Horizontal" Spacing="2" />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Width="14" Height="14" CornerRadius="2"
                                                                Background="{Binding Converter={StaticResource HexColorToBrushConverter}}"
                                                                BorderBrush="#66000000" BorderThickness="1" />
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                            <StackPanel Margin="6" Spacing="2" HorizontalAlignment="Right"
                                                        VerticalAlignment="Top">
                                                <Border Padding="6,2" CornerRadius="4"
                                                        Background="{Binding Purity, Converter={StaticResource PurityToBrushConverter}}">
                                                    <TextBlock Text="{Binding Purity}" FontSize="11"
                                                               FontWeight="SemiBold" Foreground="White" />
                                                </Border>
                                                <Border Padding="6,2" CornerRadius="4" Background="#66000000">
                                                    <TextBlock Text="{Binding Category}" FontSize="11"
                                                               Foreground="White" />
                                                </Border>
                                            </StackPanel>
                                            <Border Margin="6" Padding="6,2" CornerRadius="4" Background="#66000000"
                                                    HorizontalAlignment="Left" VerticalAlignment="Bottom">
                                                <TextBlock Text="{Binding Resolution}" FontSize="11" Foreground="White" />
                                            </Border>
                                            <StackPanel Margin="6" HorizontalAlignment="Right"
                                                        VerticalAlignment="Bottom" Spacing="2">
                                                <Border Padding="6,2" CornerRadius="4" Background="#66000000">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <FontIcon Glyph="&#xE890;" FontSize="12" Foreground="White" />
                                                        <TextBlock Text="{Binding Views}" FontSize="11"
                                                                   Foreground="White" />
                                                    </StackPanel>
                                                </Border>
                                                <Border Padding="6,2" CornerRadius="4" Background="#66000000">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <FontIcon Glyph="&#xE734;" FontSize="12" Foreground="White" />
                                                        <TextBlock Text="{Binding Favorites}" FontSize="11"
                                                                   Foreground="White" />
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                        </Grid>
                                    </Grid>
                                </Border>
                                <ToolTipService.ToolTip>
                                    <ToolTip>
                                        <StackPanel Spacing="4">
                                            <TextBlock>
                                                <Run Text="File Type: " /><Run Text="{Binding FileType}" />
                                            </TextBlock>
                                            <TextBlock>
                                                <Run Text="Ratio: " /><Run Text="{Binding Ratio}" />
                                            </TextBlock>
                                            <TextBlock>
                                                <Run Text="Size: " />
                                                <Run
                                                    Text="{Binding FileSize, Converter={StaticResource FileSizeToStringConverter}}" />
                                            </TextBlock>
                                            <TextBlock>
                                                <Run Text="Created: " /><Run Text="{Binding CreatedAt}" />
                                            </TextBlock>
                                        </StackPanel>
                                    </ToolTip>
                                </ToolTipService.ToolTip>
                            </Grid>
                        </DataTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- History page variant: includes the "Remove from History" action -->
            <Style x:Key="ResponsiveWallpaperGridViewWithHistoryMenu" TargetType="GridView"
                   BasedOn="{StaticResource ResponsiveWallpaperGridView}">
                <Setter Property="ItemTemplate">
                    <Setter.Value>
                        <DataTemplate>
                            <Grid>
                                <Border CornerRadius="8"
                                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                                    <Grid>
                                        <controls:AsyncImage Source="{Binding Thumb}" Tag="{Binding}">
                                            <controls:AsyncImage.ContextFlyout>
                                                <MenuFlyout>
                                                    <MenuFlyoutItem Text="Open in Browser" Icon="Globe"
                                                                    Command="{Binding DataContext.OpenInBrowserCommand, ElementName=RootPage}"
                                                                    CommandParameter="{Binding}" />
                                                    <MenuFlyoutItem Text="Download" Icon="Download"
                                                                    Command="{Binding DataContext.DownloadCommand, ElementName=RootPage}"
                                                                    CommandParameter="{Binding}" />
                                                    <MenuFlyoutItem Text="Set as Wallpaper" Icon="Pictures"
                                                                    Command="{Binding DataContext.SetAsWallpaperCommand, ElementName=RootPage}"
                                                                    CommandParameter="{Binding}" />
                                                    <MenuFlyoutItem Text="Set as Lock Screen" Icon="ProtectedDocument"
                                                                    Command="{Binding DataContext.SetAsLockScreenCommand, ElementName=RootPage}"
                                                                    CommandParameter="{Binding}" />
                                                    <MenuFlyoutItem Text="Set Both"
                                                                    Icon="Sync"
                                                                    Command="{Binding DataContext.SetAsBothCommand, ElementName=RootPage}"
                                                                    CommandParameter="{Binding}" />
                                                    <MenuFlyoutSeparator />
                                                    <MenuFlyoutItem Text="Remove from History" Icon="Delete"
                                                                    Command="{Binding DataContext.RemoveFromHistoryCommand, ElementName=RootPage}"
                                                                    CommandParameter="{Binding}" />
                                                </MenuFlyout>
                                            </controls:AsyncImage.ContextFlyout>
                                        </controls:AsyncImage>
                                        <!-- Overlays (absolute alignment) -->
                                        <Grid>
                                            <ItemsControl Margin="6" ItemsSource="{Binding Colors}"
                                                          HorizontalAlignment="Left" VerticalAlignment="Top">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel Orientation="Horizontal" Spacing="2" />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Width="14" Height="14" CornerRadius="2"
                                                                Background="{Binding Converter={StaticResource HexColorToBrushConverter}}"
                                                                BorderBrush="#66000000" BorderThickness="1" />
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                            <StackPanel Margin="6" Spacing="2" HorizontalAlignment="Right"
                                                        VerticalAlignment="Top">
                                                <Border Padding="6,2" CornerRadius="4"
                                                        Background="{Binding Purity, Converter={StaticResource PurityToBrushConverter}}">
                                                    <TextBlock Text="{Binding Purity}" FontSize="11"
                                                               FontWeight="SemiBold" Foreground="White" />
                                                </Border>
                                                <Border Padding="6,2" CornerRadius="4" Background="#66000000">
                                                    <TextBlock Text="{Binding Category}" FontSize="11"
                                                               Foreground="White" />
                                                </Border>
                                            </StackPanel>
                                            <Border Margin="6" Padding="6,2" CornerRadius="4" Background="#66000000"
                                                    HorizontalAlignment="Left" VerticalAlignment="Bottom">
                                                <TextBlock Text="{Binding Resolution}" FontSize="11" Foreground="White" />
                                            </Border>
                                            <StackPanel Margin="6" HorizontalAlignment="Right"
                                                        VerticalAlignment="Bottom" Spacing="2">
                                                <Border Padding="6,2" CornerRadius="4" Background="#66000000">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <FontIcon Glyph="&#xE890;" FontSize="12" Foreground="White" />
                                                        <TextBlock Text="{Binding Views}" FontSize="11"
                                                                   Foreground="White" />
                                                    </StackPanel>
                                                </Border>
                                                <Border Padding="6,2" CornerRadius="4" Background="#66000000">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <FontIcon Glyph="&#xE734;" FontSize="12" Foreground="White" />
                                                        <TextBlock Text="{Binding Favorites}" FontSize="11"
                                                                   Foreground="White" />
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                        </Grid>
                                    </Grid>
                                </Border>
                                <ToolTipService.ToolTip>
                                    <ToolTip>
                                        <StackPanel Spacing="4">
                                            <TextBlock>
                                                <Run Text="File Type: " /><Run Text="{Binding FileType}" />
                                            </TextBlock>
                                            <TextBlock>
                                                <Run Text="Ratio: " /><Run Text="{Binding Ratio}" />
                                            </TextBlock>
                                            <TextBlock>
                                                <Run Text="Size: " />
                                                <Run
                                                    Text="{Binding FileSize, Converter={StaticResource FileSizeToStringConverter}}" />
                                            </TextBlock>
                                            <TextBlock>
                                                <Run Text="Created: " /><Run Text="{Binding CreatedAt}" />
                                            </TextBlock>
                                        </StackPanel>
                                    </ToolTip>
                                </ToolTipService.ToolTip>
                            </Grid>
                        </DataTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Other app resources here -->
        </ResourceDictionary>
    </Application.Resources>
</Application>